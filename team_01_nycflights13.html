<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Owen, Nigel, Xuan Yu, Sherwyn, Ash">

<title>Lab 04</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="team_01_nycflights13_files/libs/clipboard/clipboard.min.js"></script>
<script src="team_01_nycflights13_files/libs/quarto-html/quarto.js"></script>
<script src="team_01_nycflights13_files/libs/quarto-html/popper.min.js"></script>
<script src="team_01_nycflights13_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="team_01_nycflights13_files/libs/quarto-html/anchor.min.js"></script>
<link href="team_01_nycflights13_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="team_01_nycflights13_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="team_01_nycflights13_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="team_01_nycflights13_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="team_01_nycflights13_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#collaborators" id="toc-collaborators" class="nav-link active" data-scroll-target="#collaborators">Collaborators</a></li>
  <li><a href="#other-member-pushing-the-nycflights13-folder" id="toc-other-member-pushing-the-nycflights13-folder" class="nav-link" data-scroll-target="#other-member-pushing-the-nycflights13-folder">Other member pushing the nycflights13 folder</a></li>
  <li><a href="#task-1-establishing-a-productive-software-environment-for-the-project" id="toc-task-1-establishing-a-productive-software-environment-for-the-project" class="nav-link" data-scroll-target="#task-1-establishing-a-productive-software-environment-for-the-project">Task 1: Establishing a Productive Software Environment for the Project</a></li>
  <li><a href="#task-2-aggregating-information-from-the-flights-table" id="toc-task-2-aggregating-information-from-the-flights-table" class="nav-link" data-scroll-target="#task-2-aggregating-information-from-the-flights-table">Task 2: Aggregating Information from the <code>flights</code> Table</a></li>
  <li><a href="#task-3-exploring-flights-from-new-york-city-to-chicago" id="toc-task-3-exploring-flights-from-new-york-city-to-chicago" class="nav-link" data-scroll-target="#task-3-exploring-flights-from-new-york-city-to-chicago">Task 3: Exploring Flights from New York City to Chicago</a></li>
  <li><a href="#task-4-uncovering-associations-between-weather-and-flight-operations" id="toc-task-4-uncovering-associations-between-weather-and-flight-operations" class="nav-link" data-scroll-target="#task-4-uncovering-associations-between-weather-and-flight-operations">Task 4: Uncovering Associations between Weather and Flight Operations</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lab 04</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Owen, Nigel, Xuan Yu, Sherwyn, Ash </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="collaborators" class="level1">
<h1>Collaborators</h1>
<p><img src="collaborators.png" class="img-fluid"></p>
</section>
<section id="other-member-pushing-the-nycflights13-folder" class="level1">
<h1>Other member pushing the nycflights13 folder</h1>
<p><img src="addingNYC.png" class="img-fluid"></p>
</section>
<section id="task-1-establishing-a-productive-software-environment-for-the-project" class="level1">
<h1>Task 1: Establishing a Productive Software Environment for the Project</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Create the planes table with appropriate columns</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> planes (</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    tailnum <span class="dt">VARCHAR</span>(<span class="dv">255</span>) <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">year</span> <span class="dt">INT</span>,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">type</span> <span class="dt">VARCHAR</span>(<span class="dv">255</span>),</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    manufacturer <span class="dt">VARCHAR</span>(<span class="dv">255</span>),</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    model <span class="dt">VARCHAR</span>(<span class="dv">255</span>),</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    engines <span class="dt">INT</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    seats <span class="dt">INT</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    speed <span class="dt">INT</span>,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    engine <span class="dt">VARCHAR</span>(<span class="dv">255</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">-- Import data from the CSV file</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> planes(tailnum, <span class="dt">year</span>, <span class="kw">type</span>, manufacturer, model, engines, seats, speed, engine)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> <span class="st">'C:/Users/itsss/Desktop/Lab04/nycflights13/nycflights13/planes.csv'</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>CSV <span class="kw">HEADER</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="task-2-aggregating-information-from-the-flights-table" class="level1">
<h1>Task 2: Aggregating Information from the <code>flights</code> Table</h1>
<ol type="1">
<li>What are the rankings of New York City’s main airports in terms of the total number of destinations served? Include columns for the following attributes:</li>
</ol>
<p>Three-letter airport code Airport name Number of destinations Rank Sort the results first by rank and, then, alphabetically by the three-letter airport code. Hint: use INNER JOIN to get airport names from airports table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    origin <span class="kw">AS</span> airport_code,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    a.name <span class="kw">AS</span> airport_name,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> dest) <span class="kw">AS</span> num_destinations,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">RANK</span>() <span class="kw">OVER</span> (<span class="kw">ORDER</span> <span class="kw">BY</span> <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> dest) <span class="kw">DESC</span>, origin <span class="kw">ASC</span>) <span class="kw">AS</span> <span class="fu">rank</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> flights</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> airports a <span class="kw">ON</span> flights.origin <span class="op">=</span> a.faa</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> origin, a.name</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> <span class="fu">rank</span>, airport_code;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>3 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">airport_code</th>
<th style="text-align: left;">airport_name</th>
<th style="text-align: right;">num_destinations</th>
<th style="text-align: right;">rank</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">EWR</td>
<td style="text-align: left;">Newark Liberty Intl</td>
<td style="text-align: right;">82</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">LGA</td>
<td style="text-align: left;">La Guardia</td>
<td style="text-align: right;">68</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">JFK</td>
<td style="text-align: left;">John F Kennedy Intl</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">3</td>
</tr>
</tbody>
</table>
</div>
</div>
<ol start="2" type="1">
<li>Which ten destination airports are served by the greatest number of seats from New York City? If airports are tied for the tenth place, ensure that all tied airports are included in the output. Include columns for the following attributes:</li>
</ol>
<p>Three-letter airport code Airport name Number of seats Rank</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Step 1: Aggregate total number of seats for each destination airport</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    f.dest <span class="kw">AS</span> airport_code,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    a.name <span class="kw">AS</span> airport_name,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">SUM</span>(p.seats) <span class="kw">AS</span> num_seats,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">RANK</span>() <span class="kw">OVER</span> (<span class="kw">ORDER</span> <span class="kw">BY</span> <span class="fu">SUM</span>(p.seats) <span class="kw">DESC</span>, f.dest <span class="kw">ASC</span>) <span class="kw">AS</span> <span class="fu">rank</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> flights f</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> aircraft p <span class="kw">ON</span> f.tailnum <span class="op">=</span> p.tailnum</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> airports a <span class="kw">ON</span> f.dest <span class="op">=</span> a.faa</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> f.dest, a.name</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> <span class="fu">rank</span>, airport_code</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="kw">LIMIT</span> <span class="dv">10</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: left;">airport_code</th>
<th style="text-align: left;">airport_name</th>
<th style="text-align: right;">num_seats</th>
<th style="text-align: right;">rank</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">LAX</td>
<td style="text-align: left;">Los Angeles Intl</td>
<td style="text-align: right;">3177738</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">MCO</td>
<td style="text-align: left;">Orlando Intl</td>
<td style="text-align: right;">2362894</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SFO</td>
<td style="text-align: left;">San Francisco Intl</td>
<td style="text-align: right;">2342074</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">CLT</td>
<td style="text-align: left;">Charlotte Douglas Intl</td>
<td style="text-align: right;">2201151</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ATL</td>
<td style="text-align: left;">Hartsfield Jackson Atlanta Intl</td>
<td style="text-align: right;">2103603</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">FLL</td>
<td style="text-align: left;">Fort Lauderdale Hollywood Intl</td>
<td style="text-align: right;">2081712</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ORD</td>
<td style="text-align: left;">Chicago Ohare Intl</td>
<td style="text-align: right;">1732559</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">IAH</td>
<td style="text-align: left;">George Bush Intercontinental</td>
<td style="text-align: right;">1216724</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">DEN</td>
<td style="text-align: left;">Denver Intl</td>
<td style="text-align: right;">1206507</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">TPA</td>
<td style="text-align: left;">Tampa Intl</td>
<td style="text-align: right;">1153529</td>
<td style="text-align: right;">10</td>
</tr>
</tbody>
</table>
</div>
</div>
<ol start="3" type="1">
<li>From the JFK airport, which ten destination airports are most frequently served by flights? If airports are tied for the tenth place, ensure that all tied airports are included in the output. Include columns for the following attributes:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">WITH</span> FlightCounts <span class="kw">AS</span> (</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SELECT</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>        f.dest <span class="kw">AS</span> dest_airport,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>        a.name <span class="kw">AS</span> dest_airport_name,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> num_flights</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        flights f</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">JOIN</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        airports a <span class="kw">ON</span> f.dest <span class="op">=</span> a.faa</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">WHERE</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>        f.origin <span class="op">=</span> <span class="st">'JFK'</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        f.dest, a.name</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>RankedFlights <span class="kw">AS</span> (</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SELECT</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>        dest_airport,</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        dest_airport_name,</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>        num_flights,</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">RANK</span>() <span class="kw">OVER</span> (<span class="kw">ORDER</span> <span class="kw">BY</span> num_flights <span class="kw">DESC</span>) <span class="kw">AS</span> <span class="fu">rank</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>        FlightCounts</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    dest_airport,</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    dest_airport_name,</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    num_flights,</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rank</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    RankedFlights</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rank</span> <span class="op">&lt;=</span> <span class="dv">10</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: left;">dest_airport</th>
<th style="text-align: left;">dest_airport_name</th>
<th style="text-align: right;">num_flights</th>
<th style="text-align: right;">rank</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">LAX</td>
<td style="text-align: left;">Los Angeles Intl</td>
<td style="text-align: right;">11082</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">SFO</td>
<td style="text-align: left;">San Francisco Intl</td>
<td style="text-align: right;">7751</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MCO</td>
<td style="text-align: left;">Orlando Intl</td>
<td style="text-align: right;">4735</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">BOS</td>
<td style="text-align: left;">General Edward Lawrence Logan Intl</td>
<td style="text-align: right;">4393</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">FLL</td>
<td style="text-align: left;">Fort Lauderdale Hollywood Intl</td>
<td style="text-align: right;">4003</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">BUF</td>
<td style="text-align: left;">Buffalo Niagara Intl</td>
<td style="text-align: right;">3530</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">LAS</td>
<td style="text-align: left;">Mc Carran Intl</td>
<td style="text-align: right;">3402</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">CLT</td>
<td style="text-align: left;">Charlotte Douglas Intl</td>
<td style="text-align: right;">2833</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">IAD</td>
<td style="text-align: left;">Washington Dulles Intl</td>
<td style="text-align: right;">2614</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">TPA</td>
<td style="text-align: left;">Tampa Intl</td>
<td style="text-align: right;">2380</td>
<td style="text-align: right;">10</td>
</tr>
</tbody>
</table>
</div>
</div>
<ol start="4" type="1">
<li>Among the flights that experienced a departure delay of at least 30 minutes, what percentage still managed to arrive on time? Provide the answer in a table with one row and one column. Round the percentage to two decimal places.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">ROUND</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>) </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>     <span class="kw">FROM</span> flights </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>     <span class="kw">WHERE</span> dep_delay <span class="op">&gt;=</span> <span class="dv">30</span> <span class="kw">AND</span> arr_delay <span class="op">&lt;=</span> <span class="dv">0</span>) <span class="op">*</span> <span class="fl">100.0</span> <span class="op">/</span> </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>) </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>     <span class="kw">FROM</span> flights </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>     <span class="kw">WHERE</span> dep_delay <span class="op">&gt;=</span> <span class="dv">30</span>),</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>) <span class="kw">AS</span> on_time_percentage;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>1 records</caption>
<thead>
<tr class="header">
<th style="text-align: right;">on_time_percentage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1.16</td>
</tr>
</tbody>
</table>
</div>
</div>
<ol start="5" type="1">
<li>Which ten planes, among those with at least ten flights departing from New York City, exhibited the highest observed mean speed? The speed calculation should consider the distance between airports and the time spent in the air, with each flight equally weighted in the average.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">WITH</span> FlightSpeeds <span class="kw">AS</span> (</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SELECT</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>        f.tailnum,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">AVG</span>(f.distance <span class="op">/</span> <span class="fu">NULLIF</span>(f.air_time, <span class="dv">0</span>)) <span class="kw">AS</span> mean_speed</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        flights f</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">WHERE</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        f.origin <span class="kw">IN</span> (<span class="st">'JFK'</span>, <span class="st">'LGA'</span>, <span class="st">'EWR'</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>        f.tailnum</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">HAVING</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="op">&gt;=</span> <span class="dv">10</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>RankedSpeeds <span class="kw">AS</span> (</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SELECT</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>        fs.tailnum,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>        p.manufacturer,</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>        p.model,</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>        fs.mean_speed,</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">RANK</span>() <span class="kw">OVER</span> (<span class="kw">ORDER</span> <span class="kw">BY</span> fs.mean_speed <span class="kw">DESC</span>) <span class="kw">AS</span> <span class="fu">rank</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>        FlightSpeeds fs</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">JOIN</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>        planes p <span class="kw">ON</span> fs.tailnum <span class="op">=</span> p.tailnum</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    rs.tailnum,</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    rs.manufacturer,</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    rs.model,</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ROUND</span>(rs.mean_speed, <span class="dv">2</span>) <span class="kw">AS</span> mean_speed,</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    rs.<span class="fu">rank</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>    RankedSpeeds rs</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>    rs.<span class="fu">rank</span> <span class="op">&lt;=</span> <span class="dv">10</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    rs.<span class="fu">rank</span>,</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>    rs.tailnum;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: left;">tailnum</th>
<th style="text-align: left;">manufacturer</th>
<th style="text-align: left;">model</th>
<th style="text-align: right;">mean_speed</th>
<th style="text-align: right;">rank</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">N391HA</td>
<td style="text-align: left;">AIRBUS</td>
<td style="text-align: left;">A330-243</td>
<td style="text-align: right;">7.71</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">N388HA</td>
<td style="text-align: left;">AIRBUS</td>
<td style="text-align: left;">A330-243</td>
<td style="text-align: right;">7.69</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">N382HA</td>
<td style="text-align: left;">AIRBUS</td>
<td style="text-align: left;">A330-243</td>
<td style="text-align: right;">7.65</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">N392HA</td>
<td style="text-align: left;">AIRBUS</td>
<td style="text-align: left;">A330-243</td>
<td style="text-align: right;">7.62</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">N385HA</td>
<td style="text-align: left;">AIRBUS</td>
<td style="text-align: left;">A330-243</td>
<td style="text-align: right;">7.57</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">N69063</td>
<td style="text-align: left;">BOEING</td>
<td style="text-align: left;">767-424ER</td>
<td style="text-align: right;">7.56</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">N383HA</td>
<td style="text-align: left;">AIRBUS</td>
<td style="text-align: left;">A330-243</td>
<td style="text-align: right;">7.54</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">N386HA</td>
<td style="text-align: left;">AIRBUS</td>
<td style="text-align: left;">A330-243</td>
<td style="text-align: right;">7.52</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">N389HA</td>
<td style="text-align: left;">AIRBUS</td>
<td style="text-align: left;">A330-243</td>
<td style="text-align: right;">7.50</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">N393HA</td>
<td style="text-align: left;">AIRBUS</td>
<td style="text-align: left;">A330-243</td>
<td style="text-align: right;">7.50</td>
<td style="text-align: right;">9</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="task-3-exploring-flights-from-new-york-city-to-chicago" class="level1">
<h1>Task 3: Exploring Flights from New York City to Chicago</h1>
<ol type="1">
<li>Which airport names in the <code>airports</code> table contain the string ‘<code>Chicago</code>’? Create a view named <code>chicago_airports</code> to save the result, including only the <code>faa</code> and <code>name</code> columns.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">DROP</span> <span class="kw">VIEW</span> <span class="cf">IF</span> <span class="kw">EXISTS</span> chicago_airports;</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">VIEW</span> chicago_airports <span class="kw">AS</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> faa, name</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> airports</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> name <span class="kw">LIKE</span> <span class="st">'%Chicago%'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> chicago_airports;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>5 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">faa</th>
<th style="text-align: left;">name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">GYY</td>
<td style="text-align: left;">Gary Chicago International Airport</td>
</tr>
<tr class="even">
<td style="text-align: left;">MDW</td>
<td style="text-align: left;">Chicago Midway Intl</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ORD</td>
<td style="text-align: left;">Chicago Ohare Intl</td>
</tr>
<tr class="even">
<td style="text-align: left;">PWK</td>
<td style="text-align: left;">Chicago Executive</td>
</tr>
<tr class="odd">
<td style="text-align: left;">RFD</td>
<td style="text-align: left;">Chicago Rockford International Airport</td>
</tr>
</tbody>
</table>
</div>
</div>
<ol start="2" type="1">
<li>How many flights departed from New York City to each of Chicago’s airports? Include columns for the following attributes:</li>
</ol>
<ul>
<li>Three-letter code of the destination airport</li>
<li>Name of the destination airport</li>
<li>Number of flights</li>
<li>Rank</li>
</ul>
<p>Sort the results first by rank and, then, alphabetically by the three-letter code of the destination airport.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> dest, name, <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> num_flights, <span class="fu">RANK</span>() <span class="kw">OVER</span> (<span class="kw">ORDER</span> <span class="kw">BY</span> <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">DESC</span>) <span class="kw">AS</span> <span class="fu">rank</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> flights</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> chicago_airports</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">ON</span> flights.dest <span class="op">=</span> chicago_airports.faa</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> flights.origin <span class="kw">IN</span> (<span class="st">'JFK'</span>, <span class="st">'LGA'</span>, <span class="st">'EWR'</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> dest, name</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> <span class="fu">rank</span>, dest;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>2 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">dest</th>
<th style="text-align: left;">name</th>
<th style="text-align: right;">num_flights</th>
<th style="text-align: right;">rank</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ORD</td>
<td style="text-align: left;">Chicago Ohare Intl</td>
<td style="text-align: right;">11189</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">MDW</td>
<td style="text-align: left;">Chicago Midway Intl</td>
<td style="text-align: right;">4102</td>
<td style="text-align: right;">2</td>
</tr>
</tbody>
</table>
</div>
</div>
<ol start="3" type="1">
<li>Which airlines operated flights from New York City to Chicago? Include columns for the following attributes:</li>
</ol>
<ul>
<li>Two-letter airline code</li>
<li>Airline name</li>
<li>Number of flights</li>
<li>Rank</li>
</ul>
<p>Sort the results first by rank and, then, alphabetically by the two-letter airline code.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> airlines.carrier, airlines.name, <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> num_flights, <span class="fu">RANK</span>() <span class="kw">OVER</span> (<span class="kw">ORDER</span> <span class="kw">BY</span> <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">DESC</span>) <span class="kw">AS</span> <span class="fu">rank</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> airlines</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> flights <span class="kw">ON</span> airlines.carrier <span class="op">=</span> flights.carrier</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> chicago_airports <span class="kw">ON</span> flights.dest <span class="op">=</span> chicago_airports.faa</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> flights.origin <span class="kw">IN</span> (<span class="st">'JFK'</span>, <span class="st">'LGA'</span>, <span class="st">'EWR'</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> airlines.carrier, airlines.name</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> <span class="fu">rank</span>, airlines.carrier;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>8 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">carrier</th>
<th style="text-align: left;">name</th>
<th style="text-align: right;">num_flights</th>
<th style="text-align: right;">rank</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">UA</td>
<td style="text-align: left;">United Air Lines Inc.</td>
<td style="text-align: right;">6752</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">WN</td>
<td style="text-align: left;">Southwest Airlines Co.</td>
<td style="text-align: right;">4102</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AA</td>
<td style="text-align: left;">American Airlines Inc.</td>
<td style="text-align: right;">2500</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">9E</td>
<td style="text-align: left;">Endeavor Air Inc.</td>
<td style="text-align: right;">989</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">B6</td>
<td style="text-align: left;">JetBlue Airways</td>
<td style="text-align: right;">898</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">MQ</td>
<td style="text-align: left;">Envoy Air</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EV</td>
<td style="text-align: left;">ExpressJet Airlines Inc.</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">OO</td>
<td style="text-align: left;">SkyWest Airlines Inc.</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
</tr>
</tbody>
</table>
</div>
</div>
<ol start="4" type="1">
<li>What were the ten most frequent combinations of manufacturer and model used for flights from New York City to Chicago? If manufacturer-model combinations are tied for the tenth place, incorporate all of them in the output. Include columns for each of the following attributes:</li>
</ol>
<ul>
<li>Manufacturer</li>
<li>Model</li>
<li>Number of flights</li>
<li>Rank</li>
</ul>
<p>Sort by rank, then alphabetically by manufacturer, and, lastly, by model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> manufacturer, model, <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> num_flights, <span class="fu">RANK</span>() <span class="kw">OVER</span> (<span class="kw">ORDER</span> <span class="kw">BY</span> <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">DESC</span>) <span class="kw">AS</span> <span class="fu">rank</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> planes</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> flights <span class="kw">ON</span> planes.tailnum <span class="op">=</span> flights.tailnum</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> chicago_airports <span class="kw">ON</span> flights.dest <span class="op">=</span> chicago_airports.faa</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> flights.origin <span class="kw">IN</span> (<span class="st">'JFK'</span>, <span class="st">'LGA'</span>, <span class="st">'EWR'</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> manufacturer, model</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> <span class="fu">rank</span>, manufacturer, model</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="kw">LIMIT</span> <span class="dv">10</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: left;">manufacturer</th>
<th style="text-align: left;">model</th>
<th style="text-align: right;">num_flights</th>
<th style="text-align: right;">rank</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">BOEING</td>
<td style="text-align: left;">737-7H4</td>
<td style="text-align: right;">3318</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">AIRBUS INDUSTRIE</td>
<td style="text-align: left;">A319-131</td>
<td style="text-align: right;">1946</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AIRBUS INDUSTRIE</td>
<td style="text-align: left;">A320-232</td>
<td style="text-align: right;">1743</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">MCDONNELL DOUGLAS</td>
<td style="text-align: left;">DC-9-82(MD-82)</td>
<td style="text-align: right;">1433</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BOEING</td>
<td style="text-align: left;">737-824</td>
<td style="text-align: right;">1066</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">BOMBARDIER INC</td>
<td style="text-align: left;">CL-600-2D24</td>
<td style="text-align: right;">987</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MCDONNELL DOUGLAS</td>
<td style="text-align: left;">DC-9-83(MD-83)</td>
<td style="text-align: right;">701</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">EMBRAER</td>
<td style="text-align: left;">ERJ 190-100 IGW</td>
<td style="text-align: right;">658</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BOEING</td>
<td style="text-align: left;">737-724</td>
<td style="text-align: right;">613</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">AIRBUS</td>
<td style="text-align: left;">A320-232</td>
<td style="text-align: right;">395</td>
<td style="text-align: right;">10</td>
</tr>
</tbody>
</table>
</div>
</div>
<ol start="5" type="1">
<li>For each combination of origin airport in New York City and destination airport in Chicago, what was the total number of available seats during 2013? Include columns for the following attributes:</li>
</ol>
<ul>
<li>Three-letter code of the origin airport</li>
<li>Name of the origin airport</li>
<li>Three-letter code of the destination airport</li>
<li>Name of the destination airport</li>
<li>Number of seats</li>
<li>Rank</li>
</ul>
<p>Sort the results first by the number of seats, then alphabetically by the three-letter code of the origin airport, and, lastly, by the three-letter code of the destination airport. <strong>Hint: use <code>INNER JOIN</code> combined with <code>AS</code> wisely.</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    origin, </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    a1.name <span class="kw">AS</span> origin_name, </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    dest, </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    a2.name <span class="kw">AS</span> dest_name, </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">SUM</span>(seats) <span class="kw">AS</span> num_seats, </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">RANK</span>() <span class="kw">OVER</span> (<span class="kw">ORDER</span> <span class="kw">BY</span> <span class="fu">SUM</span>(seats) <span class="kw">DESC</span>) <span class="kw">AS</span> <span class="fu">rank</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> flights</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> airports <span class="kw">AS</span> a1 <span class="kw">ON</span> flights.origin <span class="op">=</span> a1.faa</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> airports <span class="kw">AS</span> a2 <span class="kw">ON</span> flights.dest <span class="op">=</span> a2.faa</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> planes <span class="kw">ON</span> flights.tailnum <span class="op">=</span> planes.tailnum</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> chicago_airports <span class="kw">ON</span> flights.dest <span class="op">=</span> chicago_airports.faa</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> flights.<span class="dt">year</span> <span class="op">=</span> <span class="dv">2013</span> <span class="kw">AND</span> flights.origin <span class="kw">IN</span> (<span class="st">'JFK'</span>, <span class="st">'LGA'</span>, <span class="st">'EWR'</span>)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> origin, origin_name, dest, dest_name</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> num_seats <span class="kw">DESC</span>, origin, dest;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>5 records</caption>
<colgroup>
<col style="width: 10%">
<col style="width: 29%">
<col style="width: 7%">
<col style="width: 29%">
<col style="width: 14%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">origin</th>
<th style="text-align: left;">origin_name</th>
<th style="text-align: left;">dest</th>
<th style="text-align: left;">dest_name</th>
<th style="text-align: right;">num_seats</th>
<th style="text-align: right;">rank</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">LGA</td>
<td style="text-align: left;">La Guardia</td>
<td style="text-align: left;">ORD</td>
<td style="text-align: left;">Chicago Ohare Intl</td>
<td style="text-align: right;">910773</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">EWR</td>
<td style="text-align: left;">Newark Liberty Intl</td>
<td style="text-align: left;">ORD</td>
<td style="text-align: left;">Chicago Ohare Intl</td>
<td style="text-align: right;">667556</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">LGA</td>
<td style="text-align: left;">La Guardia</td>
<td style="text-align: left;">MDW</td>
<td style="text-align: left;">Chicago Midway Intl</td>
<td style="text-align: right;">290085</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">EWR</td>
<td style="text-align: left;">Newark Liberty Intl</td>
<td style="text-align: left;">MDW</td>
<td style="text-align: left;">Chicago Midway Intl</td>
<td style="text-align: right;">287708</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">JFK</td>
<td style="text-align: left;">John F Kennedy Intl</td>
<td style="text-align: left;">ORD</td>
<td style="text-align: left;">Chicago Ohare Intl</td>
<td style="text-align: right;">154230</td>
<td style="text-align: right;">5</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="task-4-uncovering-associations-between-weather-and-flight-operations" class="level1">
<h1>Task 4: Uncovering Associations between Weather and Flight Operations</h1>
<ol type="1">
<li>How many combinations of origin airport and time_hour are present in the flights table but absent from the weather table? Provide your answer in the form of a table with one row and one column.</li>
</ol>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>1 records</caption>
<thead>
<tr class="header">
<th style="text-align: right;">missing_combinations</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">101</td>
</tr>
</tbody>
</table>
</div>
</div>
<ol start="2" type="1">
<li>What is the percentage of on-time departures from each of New York City’s main airports under dry conditions (i.e., precip = 0) and under wet conditions? Include columns for the following attributes:</li>
</ol>
<p>Three-letter airport code Airport name is_dry: Boolean values indicating zero precipitation. Percentage of on-time departures, rounded to two decimal places First, sort the results alphabetically by the three-letter airport code and, then, by the presence of precipitation.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>6 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">airport_code</th>
<th style="text-align: left;">airport_name</th>
<th style="text-align: left;">is_dry</th>
<th style="text-align: right;">on_time_percentage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">EWR</td>
<td style="text-align: left;">Newark Liberty Intl</td>
<td style="text-align: left;">0</td>
<td style="text-align: right;">34.63</td>
</tr>
<tr class="even">
<td style="text-align: left;">EWR</td>
<td style="text-align: left;">Newark Liberty Intl</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">55.08</td>
</tr>
<tr class="odd">
<td style="text-align: left;">JFK</td>
<td style="text-align: left;">John F Kennedy Intl</td>
<td style="text-align: left;">0</td>
<td style="text-align: right;">43.26</td>
</tr>
<tr class="even">
<td style="text-align: left;">JFK</td>
<td style="text-align: left;">John F Kennedy Intl</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">62.18</td>
</tr>
<tr class="odd">
<td style="text-align: left;">LGA</td>
<td style="text-align: left;">La Guardia</td>
<td style="text-align: left;">0</td>
<td style="text-align: right;">41.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">LGA</td>
<td style="text-align: left;">La Guardia</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">65.96</td>
</tr>
</tbody>
</table>
</div>
</div>
<ol start="3" type="1">
<li>How do New York City’s main airports rank in terms of mean departure delay when the visibility was less than one mile? Include columns for the following attributes:</li>
</ol>
<p>Three-letter airport code Airport name Mean departure delay in minutes, rounded to two decimal places Rank Sort the results first by rank (starting with the smallest delay) and, then, alphabetically by the three-letter airport code.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>3 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">airport_code</th>
<th style="text-align: left;">airport_name</th>
<th style="text-align: right;">mean_dep_delay</th>
<th style="text-align: right;">rank</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">LGA</td>
<td style="text-align: left;">La Guardia</td>
<td style="text-align: right;">27.79</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">JFK</td>
<td style="text-align: left;">John F Kennedy Intl</td>
<td style="text-align: right;">29.01</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EWR</td>
<td style="text-align: left;">Newark Liberty Intl</td>
<td style="text-align: right;">33.41</td>
<td style="text-align: right;">3</td>
</tr>
</tbody>
</table>
</div>
</div>
<ol start="4" type="1">
<li>What is the correlation coefficient between the mean temperature of the day and the mean departure delay on that day? Round the value to two decimal places. Provide the answer in the form of a table with one row and one column. Hint: calculate the AVG() of temperature for each day in 2013, and then the AVG() of departure delay for each day in 2013. After that, calculate the CORR() between these two sequences (of length 365 or less). Remember to INNER JOIN flights and weather.</li>
</ol>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>1 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">correlation_coefficient</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">.19</td>
</tr>
</tbody>
</table>
</div>
</div>
<ol start="5" type="1">
<li>Burlington, Vermont, lies almost exactly to the north of New York City. Is the mean flight time to Burlington International Airport (BTV) shorter when the wind blows from the south (between 135 and 225 degrees) compared to when it blows from the north (between 0 and 45 degrees as well as between 315 and 360 degrees)? Provide your answer in the form of a table with one row each for north and south winds, and two columns, named wind_direction and mean_air_time. Hint: CASE expression.</li>
</ol>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>2 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">wind_direction</th>
<th style="text-align: right;">mean_air_time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">North</td>
<td style="text-align: right;">46.30265</td>
</tr>
<tr class="even">
<td style="text-align: left;">South</td>
<td style="text-align: right;">46.33754</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>